<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>COS Helpers</title>
  <script type="text/javascript" src="js/jquery/jquery-3.7.1.min.js"></script>
  <script type="text/javascript" src="js/PapaParse/papaparse.min.js"></script>
</head>
<body style="padding: 2% 15%; width: 70%;">
    <h1>COS Artist Social Media Post Generator</h1>
    <p>Make sure the tour date, time, and hashtags are set correctly.</p>
    <label for="tourDate">Tour Date:</label>
    <input type="text" id="tourDate" name="tourDate" value="Sat Nov 23, 11am-6pm" style="width:50%;">
    <br>
    <br>
    <label for="hashtags">Hashtags:</label>
    <input type="text" id="hashtags" name="hashtags" value="#cedarsdallas #cedarsopenstudios" style="width:50%;">
    <br>
    <br>
    <p>Select the spreadsheet. <b>File type must be CSV!</b></p>
    <input type="file" id="file" style="width:50%;">
    <br>
    <br>
    <label for="submit">Click to generate posts:</label>
    <button id="submit" name="submit" class="green">Generate</button>
    <br>
    <br>
    <hr>
    <div id="here" style="margin-top: 10px;">

    </div>

    <script type="text/javascript">
      var config = {
        step: processRow,
        complete: console.log
      }

      function processRow (row) {
        const currentYear = new Date().getFullYear();
        const tourDate = $("#tourDate").val();
        const hashtags = $("#hashtags").val();

        const NAME = 2;
        const ADDRESS_LINE_1 = 3;
        const ADDRESS_ZIP = 4;

        const INSTAGRAM = 8
        const FACEBOOK = 9
        const TIKTOK = 10
        const WEBSITE = 11
        const DESCRIPTION = 12;

        let socials = "";

        if (!row.data[NAME].trim()) {
          return;
        }

        const instagramHandle = row.data[INSTAGRAM].trim();
        const facebookHandle = row.data[FACEBOOK].trim();
        const tiktokHandle = row.data[TIKTOK].trim();

        if (instagramHandle) {
          const cleanHandle = instagramHandle.replace(/^\@/, '');
          socials = `<a href="https://instagram.com/${cleanHandle}">${instagramHandle}</a>`;
        } else if (facebookHandle) {
          const cleanHandle = facebookHandle.replace(/^\@/, '');
          socials = `<a href="https://facebook.com/${cleanHandle}">${facebookHandle}</a>`;
        } else if (tiktokHandle) {
          socials = `<a href="https://tiktok.com/${tiktokHandle}">${tiktokHandle}</a>`;
        }

        const website = row.data[WEBSITE].trim();
        if (website.length > 0) {
          if (socials.length > 0) {
            socials += " / "
          }

          let hrefWebsite = website;
          if (!website.startsWith("https://") && !website.startsWith("http://")) {
            hrefWebsite = `https://${website}`;
          }

          socials += `<a href="${hrefWebsite}">${website}</a>`
        }

        $("#here").append(`
          <div>
            <p><b><i>Cedars Open Studios Tour: ${currentYear}</i></b></p>
            <p><b><i>${tourDate}, closing reception to follow</i></b></p>
            <br>
            <b><i>Cedars Artist:</i> ${row.data[NAME]}</b>
            <p>${row.data[ADDRESS_LINE_1]} ${row.data[ADDRESS_ZIP]}</p>
            <p>${row.data[DESCRIPTION]}</p>
            <p>${socials}</p>

            <b><i>${hashtags}</i></b>
          </div>
          <hr>
        `);
      }

      $('#submit').click(function() {
          $('#here').empty();
          $('#file').parse({
            config: config
          });
      });
    </script>
</body>
</html>





