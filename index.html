<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>COS Helpers</title>
  <script type="text/javascript" src="js/jquery/jquery-3.7.1.min.js"></script>
  <script type="text/javascript" src="js/PapaParse/papaparse.min.js"></script>
</head>
<body style="padding: 2% 15%; width: 70%;">
    <h1>COS Artist Social Media Post Generator</h1>
    <p>Make sure the tour date, time, and hashtags are set correctly.</p>
    <label for="tourDate">Tour Date:</label>
    <input type="text" id="tourDate" name="tourDate" value="Sat Nov 23, 11am-6pm" style="width:50%;">
    <br>
    <br>
    <label for="hashtags">Hashtags:</label>
    <input type="text" id="hashtags" name="hashtags" value="#cedarsdallas #cedarsopenstudios" style="width:50%;">
    <br>
    <br>
    <p>Select the spreadsheet. <b>File type must be CSV!</b></p>
    <input type="file" id="file" style="width:50%;">
    <br>
    <br>
    <label for="submit">Click to generate posts:</label>
    <button id="submit" name="submit" class="green">Generate</button>
    <br>
    <br>
    <details>
      <summary><b>⚠️ First time using this? See instructions here</b></summary>
      <br>
      <p>This is a little helper I made to generate social media posts using the usual "Combined Sheet" from COS. For it to work properly, see the following:</p>
      <p>The prerequisite step is to download the file <b>as a CSV.</b> From Google Sheets, you can click <i>File > Download > Comma Separated Values (.csv)</i></p>
      <br><img src="./assets/csv.jpeg" style="width:100%; max-width: 700px; border: 1px solid; min-width: 500px;"><br>

      <p>Ensure that the following properties align with the following columns.</p>
      <ol>
        <li><b>Artist name</b> should be column <b><span id="NAME">C</span></b>.</li>
        <li><b>Address</b> should be column <b><span id="ADDRESS_LINE_1">D</span> and should be in each row</b>.</li>
        <li><b>Zip code</b> should be column <b><span id="ADDRESS_ZIP">E</span> and should be in each row</b>.</li>
        <li><b>Instagram handle</b> should be column <b><span id="INSTAGRAM">I</span></b>.</li>
        <li><b>Facebook handle</b> should be column <b><span id="FACEBOOK">J</span></b>.</li>
        <li><b>TikTok handle</b> should be column <b><span id="TIKTOK">K</span></b>.</li>
        <li><b>Website</b> should be column <b><span id="WEBSITE">L</span></b>.</li>
        <li><b>Artist description</b> should be column <b><span id="DESCRIPTION">M</span></b>.</li>
      </ol>
      <p>If the format of the spreadsheet has changed and the columns don't match up, let Dom know to change the columns in the code.</p>
      <p><b>⚠️ Before posting anything generated by this page, please look at it and give it a confidence check, including and especially all hyperlinks/URLs to social media pages and websites.</b></p>
    </details>
    <br><br>
    <hr>
    <div id="here" style="margin-top: 10px;">

    </div>

    <script type="text/javascript">
      var config = {
        step: processRow,
        complete: console.log
      }

      const NAME = 2;
      const ADDRESS_LINE_1 = 3;
      const ADDRESS_ZIP = 4;
      const INSTAGRAM = 8
      const FACEBOOK = 9
      const TIKTOK = 10
      const WEBSITE = 11
      const DESCRIPTION = 12;

      const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');

      $(document).ready(function() {
        $("#NAME").html(alphabet[NAME]);
        $("#ADDRESS_LINE_1").html(alphabet[ADDRESS_LINE_1]);
        $("#ADDRESS_ZIP").html(alphabet[ADDRESS_ZIP]);
        $("#INSTAGRAM").html(alphabet[INSTAGRAM]);
        $("#FACEBOOK").html(alphabet[FACEBOOK]);
        $("#TIKTOK").html(alphabet[TIKTOK]);
        $("#WEBSITE").html(alphabet[WEBSITE]);
        $("#DESCRIPTION").html(alphabet[DESCRIPTION]);
      });

      function processRow (row) {
        const currentYear = new Date().getFullYear();
        const tourDate = $("#tourDate").val();
        const hashtags = $("#hashtags").val();

        let socials = "";

        if (!row.data[NAME].trim()) {
          return;
        }

        const instagramHandle = row.data[INSTAGRAM].trim();
        const facebookHandle = row.data[FACEBOOK].trim();
        const tiktokHandle = row.data[TIKTOK].trim();

        if (instagramHandle) {
          const cleanHandle = instagramHandle.replace(/^\@/, '');
          socials = `<a href="https://instagram.com/${cleanHandle}">${instagramHandle}</a>`;
        } else if (facebookHandle) {
          const cleanHandle = facebookHandle.replace(/^\@/, '');
          socials = `<a href="https://facebook.com/${cleanHandle}">${facebookHandle}</a>`;
        } else if (tiktokHandle) {
          socials = `<a href="https://tiktok.com/${tiktokHandle}">${tiktokHandle}</a>`;
        }

        const website = row.data[WEBSITE].trim();
        if (website.length > 0) {
          if (socials.length > 0) {
            socials += " / "
          }

          let hrefWebsite = website;
          if (!website.startsWith("https://") && !website.startsWith("http://")) {
            hrefWebsite = `https://${website}`;
          }

          socials += `<a href="${hrefWebsite}">${website}</a>`
        }

        $("#here").append(`
          <div>
            <p><b><i>Cedars Open Studios Tour: ${currentYear}</i></b></p>
            <p><b><i>${tourDate}, closing reception to follow</i></b></p>
            <br>
            <b><i>Cedars Artist:</i> ${row.data[NAME]}</b>
            <p>${row.data[ADDRESS_LINE_1]} ${row.data[ADDRESS_ZIP]}</p>
            <p>${row.data[DESCRIPTION]}</p>
            <p>${socials}</p>

            <b><i>${hashtags}</i></b>
          </div>
          <hr>
        `);
      }

      $('#submit').click(function() {
          $('#here').empty();
          $('#file').parse({
            config: config
          });
      });
    </script>
</body>
</html>





